<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    // ****************ë™ê¸° ì½œë°±
    function printImmediately(print) {
        print()
    }

    printImmediately(() => {
        console.log(3)
    })

    // *******************ë¹„ë™ê¸° ì½œë°±
    function printWithDelay(print, timeout) {
        setTimeout(print, timeout)
    }

    printWithDelay(() => {
        console.log(1)
    }, 2000)

    // ********************ì½œë°± ì§€ì˜¥
    // class UserStorage {
    //     loginUser(id, password, onSuccess, onError) {
    //         setTimeout(() => {
    //             if((id === 'ellie' && password === 'dream') || (id === 'coder' && password === 'academy')) {
    //                 onSuccess(id)
    //             } else {
    //                 onError(new Error('not found'))
    //             }
    //         }, 2000)
    //     }
    //
    //     getRoles(user, onSuccess, onError) {
    //         setTimeout(() => {
    //             if(user === 'ellie') {
    //                 onSuccess({ name: 'ellie', role: 'admin' })
    //             } else {
    //                 onError(new Error('no access'))
    //             }
    //         }, 1000)
    //     }
    // }
    //
    // const userStorage = new UserStorage()
    // const id = prompt('enter your id')
    // const password = prompt('enter your password')
    // userStorage.loginUser(id, password, (user) => {
    //     userStorage.getRoles(user, (userWithRole) => {
    //         alert(`Hello ${userWithRole.name}, you have a ${userWithRole.role} role`)
    //     }, (error) => {
    //         console.log(error)
    //     })
    // }, (error) => {
    //     console.log(error)
    // })


    // *********************promise
    //ë”°ë¡œ promise()ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šì•„ë„ Promise ìƒì„±í•˜ëŠ” ìˆœê°„ ë°”ë¡œ ì‹¤í–‰ë¨
    const promise = new Promise(((resolve, reject) => {
        console.log('asdf')
        setTimeout(() => {
            // resolve('ellie')
            reject(new Error('no network'))
        }, 2000)
    }))

    promise.then((value) => {
        // í”„ë¡œë¯¸ìŠ¤ê°€ ë¦¬í„´ë¨
        console.log(value)
    }).catch((error) => {
        console.log(error)
    }).finally(() => {
        console.log('finally')
    })

    // *********************promise chaining
    const fetchNumber = new Promise(((resolve, reject) => {
        setTimeout(() => {
            resolve(1)
        }, 1000)
    }))

    fetchNumber
        .then(num => num * 2)
        .then(num => num * 3)
        .then((num) => {
        return new Promise(((resolve, reject) => {
            setTimeout(() => {
                resolve(num - 1)
            }, 1000)
        }))
    }).then((num) => {
        console.log(num)
    })


    // ********************* Error Handling
    const getHeart = () =>
        new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve('â¤')
            }, 1000)
        })

    const getLetter = heart =>
        new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve(`${heart} => ğŸ’Œ`)
                // reject(new Error('error!'))
            }, 1000)

        })

    const ok = letter =>
        new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve(`${letter} => â­•`)
            }, 1000)
        })


    getHeart()
        .then(getLetter)
        // .catch(error => 'ğŸ’¢')
        .then(ok)
        .then(console.log)
        .catch(console.log)

    // getHeart()
    //     .then(heart => getLetter(heart))
    //     .then(letter => ok(letter))
    //     .then(ok => console.log(ok))



    // **************** callback-to-promise
    // class UserStorage {
    //     loginUser(id, password) {
    //         return new Promise(((resolve, reject) => {
    //             setTimeout(() => {
    //                 if((id === 'ellie' && password === 'dream') || (id === 'coder' && password === 'academy')) {
    //                     resolve(id)
    //                 } else {
    //                     reject(new Error('not found'))
    //                 }
    //             }, 2000)
    //         }))
    //     }
    //
    //     getRoles(user) {
    //         return new Promise(((resolve, reject) => {
    //             setTimeout(() => {
    //                 if(user === 'ellie') {
    //                     resolve({ name: 'ellie', role: 'admin' })
    //                 } else {
    //                     reject(new Error('no access'))
    //                 }
    //             }, 1000)
    //         }))
    //     }
    // }
    //
    // const userStorage = new UserStorage()
    // const id = prompt('enter your id')
    // const password = prompt('enter your password')
    //
    // userStorage.loginUser(id, password)
    // .then(userStorage.getRoles)
    // .then(user => alert(
    //     `Hello ${user.name}, you have a ${user.role} role`
    // ))
    // .catch(console.log)


    // ************************ async / await
    // í”„ë¡œë¯¸ìŠ¤ëŠ” ë™ê¸°ì ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë°”ê¿”ì¤Œ
    // í”„ë¡œë¯¸ìŠ¤ ì•ˆì—ëŠ” ë¦¬ì¡¸ë¸Œë‚˜ ë¦¬ì íŠ¸ ë‘˜ ì¤‘ í•˜ë‚˜ëŠ” ê¼­ ìˆì–´ì•¼í•¨.
    // ì•„ë‹ˆë©´ ê³„ì† íŒ¬ë”© ìƒíƒœ
    // asyncë„ í”„ë¡œë¯¸ìŠ¤ê°€ í•˜ëŠ” ì¼ì„ í•´ì¤Œ
    async function fetchUser() {
        return 'ellie'
    }

    const user = fetchUser()
    user.then(console.log)
    console.log(user)

    function delay(ms) {
        return new Promise((resolve, reject) => {
            setTimeout(resolve, ms)
        })
    }

    async function getApple() {
        await delay(1000)
        return 'apple'
    }

    async function getBanana() {
        await delay(1000)
        return 'Banana'
    }

    async function pickFruits() {
        // ë³‘ë ¬ì ìœ¼ë¡œ ìˆ˜í–‰. 1ì´ˆì”© ë™ì‹œì— ìˆ˜í–‰ë¨. ê·¸ë˜ìŠ¤ 2ì´ˆ ê¸°ë‹¤ë¦´ í•„ìš” ì—†ì§€
        // ê·¸ëƒ¥ í”„ë¡œë¯¸ìŠ¤ì—ë‹¤ê°€ awaitë¥¼ ë‹¬ì•„ì£¼ë©´ ìˆœì°¨ì ìœ¼ë¡œ awaitê°€ ì‹¤í–‰ë˜ì–´ 2ì´ˆ ê¸°ë‹¬í•´ì•¼í•˜ì§€ë§Œ ë¯¸ë¦¬ í”„ë¡œë¯¸ìŠ¤ë¥¼ ìˆ˜í–‰ í›„ ë³€ìˆ˜ì— ë‹´ì•„ë†“ìœ¼ë©´ ë³‘ë ¬ë¡œ ì‹¤í–‰ë¨.
        // ì—¬ê¸°ì„œëŠ” ì‚¬ê³¼ ê°€ì§€ê³  ì˜¤ëŠ”ê±°ë‘ ë°”ë‚˜ë‚˜ ê°€ì§€ê³  ì˜¤ëŠ”ê±°ë¼ ìƒê´€ì—†ê¸° ë•Œë¬¸ì— ì´ë ‡ê²Œ í•˜ëŠ”ê²Œ íš¨ìœ¨ì .
        // í•˜ì§€ë§Œ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ì–´ì•¼ í•  ë•ŒëŠ” ì´ë ‡ê²Œ í•  í•„ìš” ã„´ã„´
        const applePromise = getApple() // í”„ë¡œë¯¸ìŠ¤ê°€ ë°”ë¡œ í˜¸ì¶œë¨. asyncë¡œ í”„ë¡œë¯¸ìŠ¤. 1ì´ˆ ë°”ë¡œ ã„±ã„±
        const bananaPromise = getBanana()// í”„ë¡œë¯¸ìŠ¤ê°€ ë°”ë¡œ í˜¸ì¶œë¨. 1ì´ˆ ë°”ë¡œ ã„±ã„±
        const apple = await applePromise
        const banana = await bananaPromise
        return `${apple} + ${banana}` // 1ì´ˆë§Œì— boom
    }

    pickFruits().then(console.log)

    // ìœ„ì—ì²˜ëŸ¼ í•´ë„ ë˜ì§€ë§Œ ìœ ìš©í•œ apiê°€ ìˆì§€.
    // Promise.all()
    // ê´„í˜¸ ì•ˆì— ë°°ì—´ë¡œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë‚˜ì—´í•´ì£¼ë©´ í”„ë¡œë¯¸ìŠ¤ë“¤ ëª¨ë‘ê°€ ëë‚  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì¤Œ
    // .thenìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ê°’ë„ ë°°ì—´ë¡œ ë¦¬í„´ë¨
    function pickAllFruits() {
        return Promise.all([getApple(), getBanana()])
        .then(fruits => fruits.join('+'))
    }

    pickAllFruits().then(console.log)

    // Promise.race() ì–˜ëŠ” ë°°ì—´ ì† í”„ë¡œë¯¸ìŠ¤ë“¤ ì¤‘ì— ê°€ì¥ ë¹¨ë¦¬ ê°’ì„ ë‚´ëŠ”
    // ì–˜ë§Œ ë¦¬í„´ì‹œí‚´
    function pickOnlyOne() {
        return Promise.race([getApple(), getBanana()])
    }

    pickOnlyOne().then(console.log)
</script>

</body>
</html>
